<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company_info.name }} POR Automator - View PORs</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
        
        // Simple refresh mechanism - just reload the page to get latest data
        function refreshPage() {
            location.reload();
        }
        
        // Load theme preference based on database on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check current database from backend and apply theme automatically
            const currentCompany = '{{ company }}';
            if (currentCompany === 'fdec') {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'enabled');
                localStorage.setItem('activeDatabase', 'FDEC');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'disabled');
                localStorage.setItem('activeDatabase', 'A&P');
            }
        });
    </script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen font-inter">
    <!-- Animated Background Pattern -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400/20 to-indigo-500/20 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-tr from-blue-300/20 to-cyan-400/20 rounded-full blur-3xl animate-pulse delay-1000"></div>
    </div>

    <div class="relative z-10 flex min-h-screen">
        {% include '_sidebar.html' %}

        <!-- Main Content -->
        <main class="flex-1 p-8 ml-20">
            <!-- Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h1 class="text-4xl font-bold text-gray-900 mb-2">Purchase Order Requests</h1>
                        <p class="text-gray-600 text-lg">View and manage all purchase order requests in the system</p>
                    </div>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="window.location.href='/upload'" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center space-x-2 relative z-10">
                            <i class="fas fa-plus"></i>
                            <span>New Upload</span>
                        </button>
                        
                        <button onclick="exportData()" class="px-6 py-3 bg-white text-gray-700 font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center space-x-2 border border-gray-200 relative z-10">
                            <i class="fas fa-download"></i>
                            <span>Export</span>
                        </button>
                        <button onclick="window.location.href='/dashboard'" class="px-6 py-3 bg-gray-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center space-x-2 relative z-10">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </button>
                        <button onclick="refreshPage()" class="px-6 py-3 bg-blue-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center space-x-2 relative z-10">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-xl border border-gray-200/50 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Filters & Search</h2>
                    <button onclick="clearFilters()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors duration-200 flex items-center space-x-2">
                        <i class="fas fa-times"></i>
                        <span>Clear All</span>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                        <input type="text" id="searchInput" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200" 
                               placeholder="Search PORs, projects, requestors...">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="statusFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                            <option value="">All Statuses</option>
                            <option value="received">Received</option>
                            <option value="sent">Sent</option>
                            <option value="filed">Filed</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company</label>
                        <select id="companyFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                            <option value="">All Companies</option>
                            <option value="a&p">A&P</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                        <select id="dateFilter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
                            <option value="">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="quarter">This Quarter</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results Summary -->
            <div class="bg-white/80 backdrop-blur-xl rounded-2xl p-6 shadow-xl border border-gray-200/50 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-4">
                        <h2 class="text-lg font-semibold text-gray-900">Results</h2>
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium" id="resultCount">0 PORs found</span>
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <span>Page</span>
                        <span id="currentPage">1</span>
                        <span>of</span>
                        <span id="totalPages">1</span>
                    </div>
                </div>
            </div>

            <!-- PORs Table -->
            <div class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl border border-gray-200/50 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
        
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PO Number</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project Name</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Requestor</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date Created</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="porsTableBody">
                            <!-- PORs will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="bg-white px-6 py-4 border-t border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-sm text-gray-700">
                            <span>Show</span>
                            <select id="pageSize" class="px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span>entries per page</span>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button onclick="previousPage()" class="px-3 py-2 text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed" id="prevBtn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <div class="flex items-center space-x-1" id="pageNumbers">
                                <!-- Page numbers will be populated here -->
                            </div>
                            
                            <button onclick="nextPage()" class="px-3 py-2 text-gray-500 hover:text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed" id="nextBtn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Store POR data in a script tag to avoid JavaScript parsing issues -->
    <script id="pors-data" type="application/json">
        {{ all_pors|tojson|default('[]') }}
    </script>

    <script>
        let currentPage = 1;
        let pageSize = 10;
        let totalPages = 1;
        let allPORs = [];

        // Load PORs from API
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize PORs data from backend
            const porsDataElement = document.getElementById('pors-data');
            window.allPORsData = porsDataElement ? JSON.parse(porsDataElement.textContent) : [];
            allPORs = window.allPORsData;
            totalPages = allPORs.length > 0 ? Math.ceil(allPORs.length / pageSize) : 1;
            
            loadPORs();
            setupEventListeners();
        });

        function loadPORs() {
            // Filter the existing PORs data based on current filters
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const companyFilter = document.getElementById('companyFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            // Get all PORs from the backend data
            let filteredPORs = window.allPORsData || [];
            
            // Apply filters
            if (searchQuery) {
                filteredPORs = filteredPORs.filter(por => 
                    por.project.toLowerCase().includes(searchQuery) ||
                    por.requestor.toLowerCase().includes(searchQuery) ||
                    por.po_number.toString().includes(searchQuery)
                );
            }
            
            if (statusFilter && statusFilter !== 'all') {
                filteredPORs = filteredPORs.filter(por => por.status === statusFilter);
            }
            
            if (companyFilter && companyFilter !== 'all') {
                filteredPORs = filteredPORs.filter(por => por.company === companyFilter);
            }
            
            if (dateFilter) {
                const today = new Date();
                const filterDate = new Date();
                
                if (dateFilter === 'today') {
                    filterDate.setDate(today.getDate());
                } else if (dateFilter === 'week') {
                    filterDate.setDate(today.getDate() - 7);
                } else if (dateFilter === 'month') {
                    filterDate.setMonth(today.getMonth() - 1);
                } else if (dateFilter === 'quarter') {
                    filterDate.setMonth(today.getMonth() - 3);
                }
                
                filteredPORs = filteredPORs.filter(por => {
                    const porDate = new Date(por.date.split('/').reverse().join('-'));
                    return porDate >= filterDate;
                });
            }
            
            // Update the global PORs array
            allPORs = filteredPORs;
            
            // Calculate pagination
            totalPages = Math.ceil(allPORs.length / pageSize);
            if (currentPage > totalPages) {
                currentPage = 1;
            }
            
            renderPORs();
            updateResultCount();
            renderPagination();
            updatePaginationButtons();
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', filterPORs);
            document.getElementById('statusFilter').addEventListener('change', filterPORs);
            document.getElementById('companyFilter').addEventListener('change', filterPORs);
            document.getElementById('dateFilter').addEventListener('change', filterPORs);
            document.getElementById('pageSize').addEventListener('change', function() {
                pageSize = parseInt(this.value);
                currentPage = 1;
                loadPORs();
            });
        }

        function filterPORs() {
            currentPage = 1;
            loadPORs();
        }

        function renderPORs() {
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pagePORs = allPORs.slice(startIndex, endIndex);
            
            totalPages = Math.ceil(allPORs.length / pageSize);
            
            // Update result count
            document.getElementById('resultCount').textContent = `${allPORs.length} PORs found`;
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            // Render table
            const tableBody = document.getElementById('porsTableBody');
            tableBody.innerHTML = pagePORs.map(por => `
                <tr class="hover:bg-gray-50 transition-colors duration-200">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-2">
                            <div class="text-sm text-gray-900 por-number" data-por-number="${por.po_number}">${por.po_number}</div>
                            <button onclick="copyPONumber('${por.po_number}')" class="text-blue-600 hover:text-blue-800 transition-colors duration-200 copy-po-btn" title="Copy PO number">
                                <i class="fas fa-copy text-xs"></i>
                            </button>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${por.project}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${por.requestor}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${por.date}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusClass(por.status)}">
                            ${getStatusText(por.status)}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewPOR(${por.id})" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-eye"></i> View
                        </button>

                        <button onclick="deletePOR(${por.id})" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Update result count and pagination
            updateResultCount();
            renderPagination();
            updatePaginationButtons();
        }

        function getStatusClass(status) {
            switch (status) {
                case 'filed': return 'bg-green-100 text-green-800';
                case 'sent': return 'bg-yellow-100 text-yellow-800';
                case 'received': return 'bg-blue-100 text-blue-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'filed': return 'Filed';
                case 'sent': return 'Sent';
                case 'received': return 'Received';
                default: return 'Unknown';
            }
        }

        function renderPagination() {
            const pageNumbers = document.getElementById('pageNumbers');
            let paginationHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `<button class="px-3 py-2 bg-blue-600 text-white rounded-lg font-medium">${i}</button>`;
                } else {
                    paginationHTML += `<button onclick="goToPage(${i})" class="px-3 py-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg">${i}</button>`;
                }
            }
            
            pageNumbers.innerHTML = paginationHTML;
        }

        function updatePaginationButtons() {
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
        }

        function updateResultCount() {
            const resultCountElement = document.getElementById('resultCount');
            if (resultCountElement) {
                resultCountElement.textContent = `${allPORs.length} PORs found`;
            }
        }

        function updatePaginationInfo() {
            // Update total pages based on current PORs count
            totalPages = allPORs.length > 0 ? Math.ceil(allPORs.length / pageSize) : 1;
            
            // Adjust current page if it's now beyond the total pages
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            
            // Update the display
            updateResultCount();
            updatePaginationButtons();
            
            // If we're on a page that no longer has data, reload
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const currentPagePORs = allPORs.slice(startIndex, endIndex);
            
            if (currentPagePORs.length === 0 && allPORs.length > 0) {
                // Go to previous page if current page is empty
                currentPage = Math.max(1, currentPage - 1);
                loadPORs();
            }
        }

        function goToPage(page) {
            currentPage = page;
            loadPORs();
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                loadPORs();
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                loadPORs();
            }
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('companyFilter').value = '';
            document.getElementById('dateFilter').value = '';
            filterPORs();
        }

        function exportData() {
            // Implement export functionality
            alert('Export functionality will be implemented here');
        }

        function viewPOR(porId) {
            // Navigate to POR detail view
            window.location.href = `/view?id=${porId}`;
        }



        function deletePOR(porId) {
            // Create modal for typed confirmation
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 400px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <h3 style="margin: 0 0 20px 0; color: #dc3545; font-size: 20px; font-weight: bold;">⚠️ Confirm Deletion</h3>
                    <p style="margin: 0 0 20px 0; color: #666; line-height: 1.5;">This action cannot be undone. This will permanently delete the POR and all associated files.</p>
                    <p style="margin: 0 0 15px 0; color: #333; font-weight: bold;">Type <span style="color: #dc3545; font-family: monospace;">DELETE</span> to confirm:</p>
                    <input type="text" id="deleteConfirmInput" placeholder="Type DELETE here" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px; margin-bottom: 20px; text-transform: uppercase;">
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('.delete-modal').remove()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">Cancel</button>
                        <button id="confirmDeleteBtn" disabled style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; opacity: 0.5;">Delete POR</button>
                    </div>
                </div>
            `;
            
            modal.className = 'delete-modal';
            document.body.appendChild(modal);
            
            const input = modal.querySelector('#deleteConfirmInput');
            const confirmBtn = modal.querySelector('#confirmDeleteBtn');
            
            // Focus on input
            input.focus();
            
            // Enable/disable confirm button based on input
            input.addEventListener('input', function() {
                if (this.value.trim().toUpperCase() === 'DELETE') {
                    confirmBtn.disabled = false;
                    confirmBtn.style.opacity = '1';
                    confirmBtn.style.cursor = 'pointer';
                } else {
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';
                    confirmBtn.style.cursor = 'not-allowed';
                }
            });
            
            // Handle Enter key
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !confirmBtn.disabled) {
                    performDelete(porId, modal);
                }
            });
            
            // Handle confirm button click
            confirmBtn.addEventListener('click', function() {
                if (!this.disabled) {
                    performDelete(porId, modal);
                }
            });
            
            // Close modal on outside click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function performDelete(porId, modal) {
            // Show loading state
            const confirmBtn = modal.querySelector('#confirmDeleteBtn');
            const originalText = confirmBtn.textContent;
            confirmBtn.textContent = 'Deleting...';
            confirmBtn.disabled = true;
            
            // Make API call to delete POR
            fetch(`/api/delete_por/${porId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Refresh the page instantly
                    window.location.reload();
                } else {
                    showNotification('error', 'Delete Failed', data.message || 'Failed to delete POR.');
                }
            })
            .catch(error => {
                console.error('Error deleting POR:', error);
                showNotification('error', 'Delete Failed', 'An error occurred while deleting the POR.');
            })
            .finally(() => {
                modal.remove();
            });
        }
        
        function showNotification(type, title, message) {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? '#28a745' : '#dc3545';
            const icon = type === 'success' ? '✅' : '❌';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10001;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 10px;">
                    <span style="font-size: 18px;">${icon}</span>
                    <div>
                        <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${message}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 4000);
        }
        
        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Copy PO Number functionality
        function copyPONumber(poNumber) {
            if (navigator.clipboard && window.isSecureContext) {
                // Use modern clipboard API
                navigator.clipboard.writeText(poNumber).then(() => {
                    showCopyFeedback(event.target, 'Copied!');
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    fallbackCopyToClipboard(poNumber, event.target);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyToClipboard(poNumber, event.target);
            }
        }

        function fallbackCopyToClipboard(text, targetElement) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopyFeedback(targetElement, 'Copied!');
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                showCopyFeedback(targetElement, 'Failed!');
            }
            
            document.body.removeChild(textArea);
        }

        function showCopyFeedback(element, message) {
            const originalHTML = element.innerHTML;
            element.innerHTML = '<i class="fas fa-check text-green-600"></i>';
            element.title = message;
            
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.title = 'Copy PO number';
            }, 2000);
        }
    </script>
        <style>
        /* Dark Mode Styles */
        .dark-mode {
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460) !important;
            color: #e2e8f0 !important;
        }
        
        .dark-mode .bg-white\/80 {
            background-color: rgba(30, 41, 59, 0.8) !important;
        }
        
        .dark-mode .text-gray-900 {
            color: #f1f5f9 !important;
        }
        
        .dark-mode .text-gray-600 {
            color: #cbd5e1 !important;
        }
        
        .dark-mode .text-gray-700 {
            color: #e2e8f0 !important;
        }
        
        .dark-mode .bg-gray-50 {
            background-color: #1e293b !important;
        }
        
        .dark-mode .border-gray-200\/50 {
            border-color: rgba(51, 65, 85, 0.5) !important;
        }
        
        .dark-mode .bg-gray-100 {
            background-color: #334155 !important;
        }
        
        .dark-mode .hover\:bg-gray-100:hover {
            background-color: #475569 !important;
        }
        
        /* Enhanced dark mode for all UI elements */
        .dark-mode .bg-white {
            background-color: #1e293b !important;
        }
        
        .dark-mode .bg-gray-50\/50 {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }
        
        .dark-mode .border-gray-200 {
            border-color: #475569 !important;
        }
        
        .dark-mode .bg-blue-50 {
            background-color: #1e3a8a !important;
        }
        
        .dark-mode .text-blue-900 {
            color: #60a5fa !important;
        }
        
        .dark-mode .text-blue-700 {
            color: #93c5fd !important;
        }
        
        .dark-mode .bg-green-50 {
            background-color: #065f46 !important;
        }
        
        .dark-mode .text-green-600 {
            color: #34d399 !important;
        }
        
        .dark-mode .bg-orange-50 {
            background-color: #92400e !important;
        }
        
        .dark-mode .text-orange-600 {
            color: #fbbf24 !important;
        }
        
        .dark-mode .bg-purple-50 {
            background-color: #581c87 !important;
        }
        
        .dark-mode .text-purple-600 {
            color: #a78bfa !important;
        }
        
        /* Dark mode for form elements */
        .dark-mode input[type="text"],
        .dark-mode input[type="email"],
        .dark-mode input[type="password"],
        .dark-mode select,
        .dark-mode textarea {
            background-color: #334155 !important;
            border-color: #475569 !important;
            color: #f1f5f9 !important;
        }
        
        .dark-mode input[type="text"]:focus,
        .dark-mode input[type="email"]:focus,
        .dark-mode input[type="password"]:focus,
        .dark-mode select:focus,
        .dark-mode textarea:focus {
            border-color: #60a5fa !important;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1) !important;
        }
        
        /* Dark mode for tables */
        .dark-mode table {
            background-color: #1e293b !important;
        }
        
        .dark-mode th {
            background-color: #334155 !important;
            color: #f1f5f9 !important;
        }
        
        .dark-mode td {
            background-color: #1e293b !important;
            color: #e2e8f0 !important;
        }
        
        .dark-mode tr:hover td {
            background-color: #334155 !important;
        }
        
        /* Dark.dark-mode for modals */
        .dark-mode .modal {
            background-color: #1e293b !important;
        }
        
        .dark-mode .modal-content {
            background-color: #334155 !important;
            border-color: #475569 !important;
        }
    </style>
</body>
</html>
